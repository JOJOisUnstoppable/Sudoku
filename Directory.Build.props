<Project>

	<!--Basic information-->
	<PropertyGroup>
		<!--Project configuration-->
		<Authors>Sunnie</Authors>
		<Copyright>Copyright (c) Sunnie 2019-2022</Copyright>
		<Version>0.7</Version>

		<!--Syntax configuration-->
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
		<LangVersion>preview</LangVersion>
		<ImplicitUsings>enable</ImplicitUsings>
	</PropertyGroup>

	<!--
	If the language version is set 'preview', we will allow it using preview runtime features,
	such as the preview feature 'static abstracts in interfaces'.
	-->
	<PropertyGroup Condition="'$(LangVersion)'=='preview'">
		<EnablePreviewFeatures>true</EnablePreviewFeatures>
	</PropertyGroup>

	<!--Set the nullable is enable if the language version is greater than or equals to C# 8.0.-->
	<PropertyGroup Condition="'$(LangVersion)'=='preview' Or '$(LangVersion)'=='latest' Or '$(LangVersion)'&gt;='8.0'">
		<Nullable>enable</Nullable>
	</PropertyGroup>

	<!--Import custom global using directives.-->
	<ItemGroup Condition="'$(LangVersion)'=='preview' Or '$(LangVersion)'=='latest' Or '$(LangVersion)'&gt;='10.0'">
		<Using Include="System.Collections.Immutable"/>
		<Using Include="System.Diagnostics"/>
		<Using Include="System.Diagnostics.CodeAnalysis"/>
		<Using Include="System.Collections"/>
		<Using Include="System.Numerics"/>
		<Using Include="System.Runtime.CompilerServices"/>
		<Using Include="System.Text"/>
		<Using Include="System.Text.Json"/>
		<Using Include="System.Text.Json.Serialization"/>
		<Using Include="System.Text.RegularExpressions"/>
		<Using Remove="System.Net.Http"/>
	</ItemGroup>

	<!--Import custom global using directives on source generator projects.-->
	<ItemGroup Condition="('$(MSBuildProjectFile.TrimEnd(`.csproj`).EndsWith(`.CodeGen`))'=='true' Or '$(MSBuildProjectFile)'=='Sudoku.Diagnostics.CodeAnalysis.csproj') And ('$(LangVersion)'=='preview' Or '$(LangVersion)'=='latest' Or '$(LangVersion)'&gt;='10.0')">
		<Using Include="Microsoft.CodeAnalysis"/>
		<Using Include="Microsoft.CodeAnalysis.CSharp"/>
		<Using Include="Microsoft.CodeAnalysis.CSharp.Syntax"/>
		<Using Include="Microsoft.CodeAnalysis.Text"/>
		<Using Remove="System.Text.Json"/>
		<Using Remove="System.Text.Json.Serialization"/>
	</ItemGroup>

	<!--Import custom global using directives on code analysis project.-->
	<ItemGroup Condition="'$(MSBuildProjectFile)'=='Sudoku.Diagnostics.CodeAnalysis.csproj' And ('$(LangVersion)'=='preview' Or '$(LangVersion)'=='latest' Or '$(LangVersion)'&gt;='10.0')">
		<Using Include="Microsoft.CodeAnalysis.Operations"/>
	</ItemGroup>

	<!--
	Import custom global using directives on source generator projects,
	which is not 'GlobalConfiguration.CodeGen'.
	-->
	<ItemGroup Condition="'$(MSBuildProjectFile.TrimEnd(`.csproj`).EndsWith(`.CodeGen`))'=='true' And '$(MSBuildProjectFile)'!='GlobalConfiguration.CodeGen.csproj' And ('$(LangVersion)'=='preview' Or '$(LangVersion)'=='latest' Or '$(LangVersion)'&gt;='10.0')">
		<Using Include="Sudoku.Diagnostics.CodeGen.Constants" Static="true"/>
	</ItemGroup>

	<!--Import custom global using directives on UI project.-->
	<ItemGroup Condition="'$(MSBuildProjectFile)'=='Sudoku.UI.csproj' And ('$(LangVersion)'=='preview' Or '$(LangVersion)'=='latest' Or '$(LangVersion)'&gt;='10.0')">
		<Using Include="Microsoft.UI.Xaml"/>
		<Using Include="Microsoft.UI.Xaml.Controls"/>
	</ItemGroup>

	<!--Set the root namespaces.-->
	<Choose>
		<When Condition="'$(MSBuildProjectFile.TrimEnd(`.csproj`).EndsWith(`.CodeGen`))'=='true'">
			<PropertyGroup>
				<RootNamespace>Sudoku.Diagnostics.CodeGen</RootNamespace>
			</PropertyGroup>
		</When>
		<When Condition="'$(MSBuildProjectFile.TrimEnd(`.csproj`).EndsWith(`.CodeAnalysis`))'=='true'">
			<PropertyGroup>
				<RootNamespace>Sudoku.Diagnostics.CodeAnalysis</RootNamespace>
			</PropertyGroup>
		</When>
	</Choose>

	<!--Select the default configuration as 'DEBUG', and set the compilation symbols.-->
	<Choose>
		<When Condition="'$(Configuration)'==''">
			<PropertyGroup>
				<Configuration>Debug</Configuration>
				<DefineConstants>DEBUG;FEATURE_GENERIC_MATH</DefineConstants>
			</PropertyGroup>
		</When>
		<When Condition="'$(Configuration)'=='Debug'">
			<PropertyGroup>
				<DefineConstants>DEBUG;FEATURE_GENERIC_MATH</DefineConstants>
			</PropertyGroup>
		</When>
		<When Condition="'$(Configuration)'=='Release'">
			<PropertyGroup>
				<DefineConstants>FEATURE_GENERIC_MATH</DefineConstants>
			</PropertyGroup>
		</When>
	</Choose>

	<!--Import 'Microsoft.CodeAnalysis.*' packages if the project is a source generator project.-->
	<ItemGroup Condition="'$(MSBuildProjectFile.TrimEnd(`.csproj`).EndsWith(`.CodeGen`))'=='true' Or '$(MSBuildProjectFile)'=='Sudoku.Diagnostics.CodeAnalysis.csproj'">
		<PackageReference Include="Microsoft.CodeAnalysis.Common" Version="4.0.1" />
		<PackageReference Include="Microsoft.CodeAnalysis.CSharp" Version="4.0.1" />
		<PackageReference Include="Microsoft.CodeAnalysis.CSharp.Workspaces" Version="4.0.1" />
		<PackageReference Include="IndexRange" Version="1.0.0" />
	</ItemGroup>

	<!--Try to reference the code analysis project.-->
	<Choose>
		<!--We will skip to reference code analysis project to prevent a cycle referencing.-->
		<When Condition="'$(MSBuildProjectFile)'=='Sudoku.Diagnostics.CodeAnalysis.CodeGen.csproj'" />
		<When Condition="'$(MSBuildProjectFile)'=='GlobalConfiguration.CodeGen.csproj'" />

		<!--If the project is not a C# project, just skip it.-->
		<When Condition="'$(MSBuildProjectFile.EndsWith(`.csproj`))'=='false'" />

		<!--Other C# projects, reference it.-->
		<When Condition="'$(MSBuildProjectFile)'!='Sudoku.Diagnostics.CodeAnalysis.csproj'">
			<ItemGroup>
				<ProjectReference
						Include="..\Sudoku.Diagnostics.CodeAnalysis\Sudoku.Diagnostics.CodeAnalysis.csproj"
						OutputItemType="Analyzer"
						ReferenceOutputAssembly="true" />
			</ItemGroup>
		</When>
	</Choose>

	<!--Import 'GlobalConfiguration.CodeGen' project into the source genrator projects.-->
	<ItemGroup Condition="'$(MSBuildProjectFile.TrimEnd(`.csproj`).EndsWith(`.CodeGen`))'=='true' And '$(MSBuildProjectFile)'!='GlobalConfiguration.CodeGen.csproj'">
		<AdditionalFiles Include="..\..\Directory.Build.props" />
		<ProjectReference
				Include="..\GlobalConfiguration.CodeGen\GlobalConfiguration.CodeGen.csproj"
				OutputItemType="Analyzer"
				ReferenceOutputAssembly="true" />
	</ItemGroup>

</Project>